(function(e){function t(t){for(var r,i,s=t[0],l=t[1],c=t[2],f=0,h=[];f<s.length;f++)i=s[f],Object.prototype.hasOwnProperty.call(o,i)&&o[i]&&h.push(o[i][0]),o[i]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r]);u&&u(t);while(h.length)h.shift()();return a.push.apply(a,c||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,s=1;s<n.length;s++){var l=n[s];0!==o[l]&&(r=!1)}r&&(a.splice(t--,1),e=i(i.s=n[0]))}return e}var r={},o={app:0},a=[];function i(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var u=l;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"0c4e":function(e,t,n){"use strict";var r=n("2e40"),o=n.n(r);o.a},1:function(e,t){},2:function(e,t){},"2e40":function(e,t,n){},"51f2":function(e,t,n){"use strict";n.r(t),t["default"]=n.p+"6d2953db31970ebe713bfa30b737ad62.csv"},"56d7":function(e,t,n){"use strict";n.r(t);n("caad"),n("2532"),n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("Layout",[n("Header",[n("Menu",{attrs:{mode:"horizontal",theme:"dark"},on:{"on-select":e.eventHandler}},[n("h1",{staticClass:"layout-logo"},[e._v("Density-based Timebox")]),n("div",{staticClass:"layout-nav"},[n("Upload",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"upload",attrs:{action:"/","before-upload":e.readFileHandler}}),n("Submenu",{attrs:{name:"3"}},[n("template",{slot:"title"},[n("Icon",{attrs:{type:"ios-archive"}}),e._v(" Example data ")],1),n("MenuItem",{attrs:{name:"1-1"}},[e._v("Stocks(25.2M)")]),n("MenuItem",{attrs:{name:"1-2"}},[e._v("Airline(10.6M)")]),n("MenuItem",{attrs:{name:"1-3"}},[e._v("Weather(29.6M)")]),n("MenuItem",{attrs:{name:"1-4"}},[e._v("Reading(18.5M)")])],2),n("MenuItem",{attrs:{name:"2"}},[n("Icon",{attrs:{type:"ios-cloud-upload-outline"}}),e._v(" Load data ")],1)],1)])],1),n("Content",{style:{width:"1850px",margin:"0 auto",padding:"0 50px",display:"flex",flexDirection:"row"}},[n("Card",{staticClass:"sticky-content"},[n("div",[n("p",[e._v("Line Aggregation Attribute:")]),n("Select",{staticStyle:{width:"200px"},model:{value:e.aggregateAttr,callback:function(t){e.aggregateAttr=t},expression:"aggregateAttr"}},e._l(e.headers,(function(t,r){return n("Option",{key:r,attrs:{value:r}},[e._v(e._s(t))])})),1),n("p",[e._v("Time Attribute:")]),n("Select",{staticStyle:{width:"200px"},model:{value:e.timeAttr,callback:function(t){e.timeAttr=t},expression:"timeAttr"}},[e._l(e.headers,(function(t,r){return["string"!=e.inferTypes[r]?n("Option",{key:r,attrs:{value:r}},[e._v(e._s(t))]):e._e()]}))],2),n("p",[e._v("Value Attribute(s):")]),n("Select",{staticStyle:{width:"200px"},attrs:{multiple:""},model:{value:e.valueAttr,callback:function(t){e.valueAttr=t},expression:"valueAttr"}},[e._l(e.headers,(function(t,r){return["number"==e.inferTypes[r]?n("Option",{key:r,attrs:{value:r}},[e._v(e._s(t))]):e._e()]}))],2),n("br"),n("br"),n("Button",{staticStyle:{width:"200px"},attrs:{type:"primary",disabled:!e.headers.length},on:{click:e.generateCharts}},[e._v("generate chart(s)")])],1)]),n("Card",{staticStyle:{"margin-left":"20px","flex-grow":"1"}},[e.headers.length?n("div",[e.chartConfigs.length?n("div",[e._l(e.chartConfigs,(function(t,r){return[n("CanvasBox",{key:t.aggregateName+"#"+t.timeName+"#"+t.valueName,attrs:{timeIndex:t.timeIndex,valueIndex:t.valueIndex,timeName:t.timeName,valueName:t.valueName,filter:t.filter},on:{filterChange:function(t){return e.handleFilterChange(r,t)}}})]}))],2):n("div",{staticStyle:{"min-height":"200px",color:"red"}},[e._v(" Please use a valid configuration in left panel! ")])]):n("div",{staticStyle:{"min-height":"200px",color:"red"}},[e._v(" Please load a dataset (.csv file) first! "),n("Button",{staticStyle:{margin:"0 12px"},attrs:{type:"primary",icon:"ios-archive"},on:{click:function(t){return e.eventHandler("1-1")}}},[e._v("Example Stocks(25.2M)")]),n("Button",{staticStyle:{margin:"0 12px"},attrs:{type:"primary",icon:"ios-archive"},on:{click:function(t){return e.eventHandler("1-2")}}},[e._v("Example Airline(10.6M)")]),n("Button",{staticStyle:{margin:"0 12px"},attrs:{type:"primary",icon:"ios-archive"},on:{click:function(t){return e.eventHandler("1-3")}}},[e._v("Example Weather(29.6M)")]),n("Button",{staticStyle:{margin:"0 12px"},attrs:{type:"primary",icon:"ios-archive"},on:{click:function(t){return e.eventHandler("1-4")}}},[e._v("Example Reading(18.5M)")]),n("Button",{staticStyle:{margin:"0 12px"},attrs:{type:"primary",icon:"ios-cloud-upload-outline"},on:{click:function(t){return e.eventHandler("2")}}},[e._v("Load data")])],1)])],1)],1)],1)},a=[],i=(n("99af"),n("4de4"),n("7db0"),n("4160"),n("c975"),n("d81d"),n("13d5"),n("fb6a"),n("a434"),n("ace4"),n("4ec9"),n("4fad"),n("d3b7"),n("ac1f"),n("25f0"),n("6062"),n("3ca3"),n("1276"),n("2ca0"),n("cfc3"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e"),n("219c"),n("170b"),n("b39a"),n("72f7"),n("159b"),n("ddb0"),n("2909")),s=n("3835"),l=n("b85c"),c=n("ade3"),u=n("5530"),f=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{display:"flex","flex-direction":"row","align-items":"center",margin:"15px 0 15px 20px",position:"relative"}},[n("canvas",{ref:"canvas",style:{width:"1000px",height:"500px",cursor:e.cursor,transform:"scaleY("+e.upsideDownFactor+")"},attrs:{width:"1000",height:"500"},on:{mousedown:e.startMouse,mousemove:e.moveMouse,click:e.angleConfirm}}),n("canvas",{ref:"canvasRawLine",staticStyle:{width:"1000px",height:"500px","pointer-events":"none",position:"absolute",top:"0",left:"0"},style:{transform:"scaleY("+e.upsideDownFactor+")"},attrs:{width:"1000",height:"500"}}),n("canvas",{ref:"canvasOverlay",staticStyle:{width:"1000px",height:"500px","pointer-events":"none",position:"absolute",top:"0",left:"0"},style:{transform:"scaleY("+e.upsideDownFactor+")"},attrs:{width:"1000",height:"500"}}),n("div",{ref:"axisTop",staticStyle:{width:"1000px",height:"30px",position:"absolute",top:"-30px",left:"0"}}),n("div",{ref:"axisBottom",staticStyle:{width:"1000px",height:"30px",position:"absolute",bottom:"-30px",left:"0"}}),n("div",{ref:"axisLeft",staticStyle:{width:"30px",height:"500px",position:"absolute",top:"0px",left:"-30px"}}),n("div",{staticClass:"control-panel"},[n("p",[e._v('Chart of "'+e._s(e.timeName)+'" - "'+e._s(e.valueName)+'"')]),n("Button",{attrs:{icon:"md-sync"},on:{click:e.resetFilter}},[e._v("reset filters")]),n("div",[n("span",[e._v("Filter line strategy: ")]),n("RadioGroup",{attrs:{type:"button"},model:{value:e.filterMode,callback:function(t){e.filterMode=t},expression:"filterMode"}},[n("Radio",{attrs:{label:"rect"}},[e._v("Rectangle Range")]),n("Radio",{attrs:{label:"ang"}},[e._v("Angular Range")])],1)],1),n("div",[n("span",[e._v("Raw line strategy: ")]),n("RadioGroup",{attrs:{type:"button"},model:{value:e.rawMode,callback:function(t){e.rawMode=t},expression:"rawMode"}},[n("Radio",{attrs:{label:"null"}},[e._v("Null")]),n("Radio",{attrs:{label:"cur"}},[e._v("Hover")]),n("Radio",{attrs:{label:"out"}},[e._v("Min")]),n("Radio",{attrs:{label:"rep"}},[e._v("Max")])],1)],1),"rep"==e.rawMode?n("div",{staticStyle:{display:"flex","align-items":"center"}},[n("span",{staticStyle:{"margin-right":"8px"}},[e._v("Weight")]),n("Slider",{staticStyle:{"flex-grow":"1"},attrs:{min:0,max:1,step:.001,"show-tip":"never"},model:{value:e.diverse,callback:function(t){e.diverse=t},expression:"diverse"}}),n("span",{staticStyle:{"margin-left":"8px"}},[e._v("Diverse")])],1):e._e(),"null"!=e.rawMode?n("div",e._l([0,1,2],(function(t){return n("div",{key:t},[n("span",[n("ColorPicker",{attrs:{recommend:"",alpha:""},model:{value:e.colorMap[t],callback:function(n){e.$set(e.colorMap,t,n)},expression:"colorMap[i]"}})],1),n("Poptip",{attrs:{trigger:"hover",placement:"bottom-end",width:800,title:"Data preview"},on:{"on-popper-show":function(n){e.previewIndex=e.rawLines[t]}}},[t<e.rawLineNames.length?n("span",{staticStyle:{"margin-left":"12px"}},[e._v(e._s(e.rawLineNames[t]))]):e._e(),n("div",{attrs:{slot:"content"},slot:"content"},[n("Table",{attrs:{columns:e.headers,data:e.previewData}})],1)])],1)})),0):e._e(),n("div",[n("span",[e._v("Color map: ")]),n("span",[e._v("1")]),n("span",{staticClass:"color-map"}),n("InputNumber",{attrs:{min:1,"active-change":!1},model:{value:e.maxDensity,callback:function(t){e.maxDensity=t},expression:"maxDensity"}})],1),n("div",[n("span",[e._v("Upside down:")]),n("iSwitch",{staticStyle:{"margin-left":"12px"},model:{value:e.upsideDown,callback:function(t){e.upsideDown=t},expression:"upsideDown"}})],1),n("Button",{attrs:{icon:"md-cloud-download",type:"primary"},on:{click:e.exportFig}},[e._v("export figure")])],1)])},h=[],d=(n("cb29"),n("a9e3"),1/0),m=1/0,p=1e3,v=500,g=n("b5bb"),b=n.n(g),x=(n("9389"),n("4b31"),n("7f6b"),function(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")});function w(e){for(var t=new Float32Array(e),n=0;n<e;n++)t[n]=n;return t}function y(e){return e-Math.floor(e)>0?e:Math.floor(e)+".0"}function C(e,t){var n,r,o=document.createElement("canvas");o.width=1e3,o.height=500;var a=o.getContext("2d");t&&a.scale(1,-1);try{for(var i=x(e),s=i.next();!s.done;s=i.next()){var l=s.value;a.drawImage(l,0,t?-l.height:0)}}catch(u){n={error:u}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}var c=document.createElement("a");c.href=o.toDataURL().replace(/^data:image\/[^;]*/,"data:application/octet-stream"),c.download="export.png",c.click()}function M(e,t,n){return e.map((function(e){return Math.max(t,Math.min(n,e))}))}var D=n("5596"),_={data:[],aggregatedData:[],headers:[]},A=n("7dbb"),k=n.n(A),S=function(){return S=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},S.apply(this,arguments)},T=function(e,t,n,r){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,a){function i(e){try{l(r.next(e))}catch(t){a(t)}}function s(e){try{l(r["throw"](e))}catch(t){a(t)}}function l(e){e.done?n(e.value):o(e.value).then(i,s)}l((r=r.apply(e,t||[])).next())}))},L=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(e){return function(t){return l([e,t])}}function l(a){if(n)throw new TypeError("Generator is already executing.");while(i)try{if(n=1,r&&(o=2&a[0]?r["return"]:a[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(o=i.trys,!(o=o.length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(s){a=[6,s],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},O=function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{while((void 0===t||t-- >0)&&!(r=a.next()).done)i.push(r.value)}catch(s){o={error:s}}finally{try{r&&!r.done&&(n=a["return"])&&n.call(a)}finally{if(o)throw o.error}}return i},F=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(O(arguments[t]));return e},j=function(e,t,n,r,o,a,i,s,l,c,u){return void 0===i&&(i=1),void 0===s&&(s=0),void 0===l&&(l=0),void 0===c&&(c=1),T(this,void 0,void 0,(function(){function f(e){var t=[!1,!1,!1,!1];return t[e%4]=!0,t}var h,p,v,g,x,C,D,_,A,T,j,R,Y,I,H,V,X,P,$,N,z,B,W,G,q,K,U,J,Q,Z,ee,te,ne,re,oe,ae,ie,se,le,ce,ue,fe,he,de,me,pe;return L(this,(function(L){if(h=O([e.length,t[1]],2),p=h[0],v=h[1],!!o,g=Math.floor((n.stop-n.start)/n.step),x=Math.floor((r.stop-r.start)/r.step),void 0===a&&(a=[[1,2,1],[2,8,2],[1,2,1]]),void 0===u&&(u={xRatio:1,yRatio:1,xOffset:0,yOffset:0}),a.find((function(e){return e.length!=a.length})))throw new Error("The input Gaussian kernal should be square matrix.");if(a.length%2==0)throw new Error("The input Gaussian kernal size should be odd.");for(C=Math.round((a.length-1)/2),console.info("Heatmap size: "+g+"x"+x),console.info("GaussianKernelSize: "+a.length+"x"+a.length),D=k()({canvas:o||document.createElement("canvas"),extensions:["OES_texture_float"],attributes:{preserveDrawingBuffer:!0}}),D.on("lost",(function(){alert("Out of GPU memory, charts will be destroyed!")})),_=Math.min(D.limits.maxRenderbufferSize,4096),A=Math.floor(_/g),T=Math.floor(_/x),j=Math.min(A,Math.ceil(p/4-1e-6),d),R=Math.min(T,Math.ceil(p/(4*j)),m),console.info("Can repeat "+A+"x"+T+" times. Repeating "+j+"x"+R+" times."),Y=g*j,I=x*R,console.info("Canvas size "+Y+"x"+I+". Tangent Gaussian size "+s+". Normal Gaussian size "+y(l)+". Line width "+i+". MaxX "+n.stop+". MaxY "+r.stop),H=D({vert:"\n    precision mediump float;\n      \n    attribute float time;\n    attribute float value;\n  \n    uniform float maxX;\n    uniform float maxY;\n    uniform float column;\n    uniform float row;\n  \n    void main() {\n      float repeatsX = "+y(j)+";\n      float repeatsY = "+y(R)+";\n  \n      // time and value start at 0 so we can simplify the scaling\n      float x = column / repeatsX + time / (maxX * repeatsX);\n      \n      // move up by 0.3 pixels so that the line is guaranteed to be drawn\n      float yOffset = row / repeatsY + 0.3 / "+y(I)+";\n      // squeeze by 0.6 pixels\n      float squeeze = 1.0 - 0.6 / "+y(x)+";\n      float yValue = value / (maxY * repeatsY) * squeeze;\n      float y = yOffset + yValue;\n  \n      // squeeze y by 0.3 pixels so that the line is guaranteed to be drawn\n      float yStretch = 2.0 - 0.6 / "+y(I)+";\n  \n      // scale to [-1, 1]\n      gl_Position = vec4(\n        2.0 * (x - 0.5),\n        2.0 * (y - 0.5),\n        0, 1);\n    }",frag:"\n    precision mediump float;\n    varying vec4 uv;\n  \n    void main() {\n      // we will control the color with the color mask\n      gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n    }",uniforms:{maxX:D.prop("maxX"),maxY:D.prop("maxY"),column:D.prop("column"),row:D.prop("row")},attributes:{time:D.prop("times"),value:D.prop("values")},colorMask:D.prop("colorMask"),depth:{enable:!1,mask:!1},count:D.prop("count"),primitive:"line strip",lineWidth:function(){return 1},framebuffer:D.prop("out")}),V=D({vert:"\n        precision mediump float;\n\n        attribute float value;\n        attribute float time;\n\n        uniform float maxX;\n        uniform float maxY;\n        uniform float lineIdx;\n\n        varying float v;\n\n        void main() {\n          v = value / maxY;\n\n          vec2 position = vec2(time / maxX, (floor(lineIdx / 4.0) + 0.5) / ceil("+y(e.length)+" / 4.0));\n\n          // scale to [-1, 1]\n          gl_Position = vec4(\n            2.0 * (position.x - 0.5),\n            2.0 * (position.y - 0.5),\n            0, 1);\n        }",frag:"\n        precision mediump float;\n\n        varying float v;\n      \n        void main() {\n          gl_FragColor = vec4(v);\n        }",uniforms:{maxX:D.prop("maxX"),maxY:D.prop("maxY"),lineIdx:D.prop("lineIdx")},attributes:{value:D.prop("values"),time:D.prop("times")},colorMask:D.prop("colorMask"),blend:{enable:!0,func:{srcRGB:"one",srcAlpha:1,dstRGB:"one",dstAlpha:1},equation:{rgb:"add",alpha:"add"},color:[0,0,0,0]},depth:{enable:!1,mask:!1},count:D.prop("count"),primitive:"line strip",lineWidth:function(){return 1},framebuffer:D.prop("flatOut")}),X={vert:"\n        precision mediump float;\n      \n        attribute vec2 position;\n        varying vec2 uv;\n      \n        void main() {\n          uv = 0.5 * (position + 1.0);\n          gl_Position = vec4(position, 0, 1);\n        }",attributes:{position:[-4,-4,4,-4,0,4]},depth:{enable:!1,mask:!1},count:3},P=D(S(S({},X),{frag:"\n      precision mediump float;\n    \n      uniform sampler2D buffer;\n    \n      varying vec2 uv;\n    \n      vec4 getColor(int offsetX, int offsetY) {\n        const int canvasWidth = "+Y+";\n        const int canvasHeight = "+I+";\n        const int sampleWidth = "+g+";\n        const int sampleHeight = "+x+";\n    \n        int currentX = int(uv.x * float(canvasWidth) + 1e-1);\n        int currentY = int(uv.y * float(canvasHeight) + 1e-1);\n        int refX = currentX + offsetX;\n        int refY = currentY + offsetY;\n    \n        if (currentX / sampleWidth == refX / sampleWidth && currentY / sampleHeight == refY / sampleHeight && refX >= 0 && refY >= 0) {\n          vec2 offsetPixel = vec2(float(offsetX), float(offsetY)) / vec2(float(canvasWidth), float(canvasHeight));\n          return texture2D(buffer, uv + offsetPixel);\n        } else {\n          return vec4(0.0, 0.0, 0.0, 0.0);\n        }\n      }\n    \n      void main() {\n        gl_FragColor = "+a.map((function(e,t){return e.map((function(e,n){return"getColor("+(C-n)+", "+(t-C)+") * "+y(e)})).join(" + ")})).join(" + ")+";\n      }\n    ",uniforms:{buffer:D.prop("buffer")},framebuffer:D.prop("out")})),$=D(S(S({},X),{frag:"\n        precision mediump float;\n      \n        uniform sampler2D buffer;\n        varying vec2 uv;\n      \n        void main() {\n          float texelRowStart = floor(uv.y * "+y(R)+") / "+y(R)+";\n          float texelColumnStart = floor(uv.x * "+y(j)+") / "+y(j)+";\n      \n          "+(2!==c?"\n          // normalize by the column\n          vec4 sum = vec4(0.0);\n          for (float j = 0.0; j < "+y(x)+"; j++) {\n            float texelRow = texelRowStart + (j + 0.5) / "+y(I)+";\n            vec4 value = texture2D(buffer, vec2(uv.x, texelRow));\n            sum += value;\n          }\n          ":"\n          // normalize by the column\n          vec4 sum = vec4(0.0);\n          for ( float i = 0.0; i< "+y(g)+"; i++) {\n            float texelColumn = texelColumnStart + (i + 0.5) / "+y(Y)+";\n            for (float j = 0.0; j < "+y(x)+"; j++) {\n              float texelRow = texelRowStart + (j + 0.5) / "+y(I)+";\n              vec4 value = texture2D(buffer, vec2(texelColumn, texelRow));\n              sum += value;\n            }\n          }\n          \n          ")+"\n      \n          // sum should be at least 1, prevents problems with empty buffers\n          gl_FragColor = max(vec4(1.0), sum);\n        }",uniforms:{buffer:D.prop("buffer")},framebuffer:D.prop("out")})),N=D(S(S({},X),{frag:"\n        precision mediump float;\n      \n        uniform sampler2D buffer;\n        uniform sampler2D sums;\n        varying vec2 uv;\n      \n        void main() {\n          vec4 value = texture2D(buffer, uv);\n          vec4 sum = texture2D(sums, uv);\n      \n          "+(c?"gl_FragColor = value / sum;":"gl_FragColor = value;")+"\n        }",uniforms:{sums:D.prop("sums"),buffer:D.prop("buffer")},blend:{enable:!0,func:{srcRGB:"one",srcAlpha:1,dstRGB:"one",dstAlpha:1},equation:{rgb:"add",alpha:"add"},color:[0,0,0,0]},framebuffer:D.prop("out")})),z=D(S(S({},X),{frag:"\n        precision mediump float;\n      \n        uniform sampler2D buffer;\n      \n        varying vec2 uv;\n      \n        void main() {\n          vec4 color = vec4(0);\n      \n          // collect all columns\n          for (float i = 0.0; i < "+y(j)+"; i++) {\n            float x = (i + uv.x) / "+y(j)+";\n            color += texture2D(buffer, vec2(x, uv.y));\n          }\n      \n          gl_FragColor = color;\n        }",uniforms:{buffer:D.prop("buffer")},framebuffer:D.prop("out")})),B=D(S(S({},X),{frag:"\n        precision mediump float;\n      \n        uniform sampler2D buffer;\n      \n        varying vec2 uv;\n      \n        void main() {\n          vec4 color = vec4(0);\n      \n          // collect all rows\n          for (float i = 0.0; i < "+y(R)+"; i++) {\n            float y = (i + uv.y) / "+y(R)+";\n            color += texture2D(buffer, vec2(uv.x, y));\n          }\n      \n          float value = color.r + color.g + color.b + color.a;\n          gl_FragColor = vec4(vec3(value), 1.0);\n        }",uniforms:{buffer:D.prop("buffer")},framebuffer:D.prop("out")})),W=D(S(S({},X),{frag:"\n        precision mediump float;\n      \n        uniform sampler2D buffer;\n        uniform float plasma[33];\n        uniform float maxi;\n        \n        varying vec2 uv;\n        \n        void main() {\n          // get r and draw it\n          float value = texture2D(buffer, uv).r;\n\n          if (value <= 0.01) {\n            gl_FragColor = vec4(0);\n          } else {\n            float normValue = value / maxi;\n            float step = 1.0 / 10.0;\n            for (int i = 0; i < 10; i++) {\n              if (normValue <= float(i + 1) * step) {\n                float rangeValue = (normValue - float(i) * step) * 10.0;\n                vec3 aColor = vec3(plasma[i * 3 + 0], plasma[i * 3 + 1], plasma[i * 3 + 2]);\n                vec3 bColor = vec3(plasma[(i + 1) * 3 + 0], plasma[(i + 1) * 3 + 1], plasma[(i + 1) * 3 + 2]);\n                gl_FragColor = vec4(aColor * (1.0 - rangeValue) + bColor * rangeValue, 1.0);\n                return;\n              }\n            }\n            gl_FragColor = vec4(plasma[30], plasma[31], plasma[32], 1);\n          }\n        }",uniforms:S({buffer:D.prop("buffer"),maxi:D.prop("maxi")},[[.9882352941176471,.9921568627450981,.7490196078431373],[.996078431372549,.807843137254902,.5686274509803921],[.996078431372549,.6235294117647059,.42745098039215684],[.9686274509803922,.43529411764705883,.3607843137254902],[.8705882352941177,.28627450980392155,.40784313725490196],[.7137254901960784,.21568627450980393,.47843137254901963],[.5490196078431373,.1607843137254902,.5058823529411764],[.396078431372549,.10196078431372549,.5019607843137255],[.23137254901960785,.058823529411764705,.4392156862745098],[.08235294117647059,.054901960784313725,.21568627450980393],[0,0,.01568627450980392]].reduce((function(e,t){return F(e,t)}),[]).reduce((function(e,t,n){var r;return S(S({},e),(r={},r["plasma["+n+"]"]=t,r))}),{}))})),G=D(S(S({},X),{frag:"\n        precision mediump float;\n      \n        uniform sampler2D buffer;\n        uniform float startTime;\n        uniform float endTime;\n        uniform float startAngle;\n        uniform float endAngle;\n        \n        varying vec2 uv;\n        \n        void main() {\n          // get r and draw it\n          float width = "+y(g)+";\n          float height = "+y(x)+";\n          float start = startTime * width;\n          float end = endTime * width;\n          vec4 result = vec4(1);\n          vec4 valid = vec4(0);\n          for (float pointer = 0.0;pointer<="+y(g)+";pointer++){\n            if (pointer >= start && pointer <= end){\n              vec4 angle = texture2D(buffer, vec2((pointer + 0.5) / width, uv.y));\n              for (float pointer2 = 0.0;pointer2<="+y(g)+";pointer2++){\n                if (pointer2 > pointer && pointer2 <= end){\n                  vec4 angle2 = texture2D(buffer, vec2((pointer2 + 0.5) / width, uv.y));\n                  float diff = 0.0;\n                  "+[0,1,2,3].map((function(e){return"\n                  if(angle2["+e+"] > 0.0) {\n                    valid["+e+"] = 1.0;\n                  }\n                  diff = (angle2["+e+"] - angle["+e+"]) * 500.0 / (pointer2 - pointer) * width / 1000.0;\n                  if (diff < startAngle || diff > endAngle) {\n                    result["+e+"] = 0.0;\n                  }\n                  "})).join("")+"\n                }\n              }\n            }\n          }\n          "+[0,1,2,3].map((function(e){return"\n          if(valid["+e+"] <= 0.0) {\n            result["+e+"] = 0.0;\n          }\n          "})).join("")+"\n          gl_FragColor = result;\n        }",uniforms:{buffer:D.prop("buffer"),startTime:D.prop("startTime"),endTime:D.prop("endTime"),startAngle:D.prop("startAngle"),endAngle:D.prop("endAngle")},framebuffer:D.prop("out")})),q=D(S(S({},X),{frag:"\n        precision mediump float;\n      \n        uniform sampler2D buffer;\n        uniform float startTime;\n        uniform float endTime;\n        uniform float startValue;\n        uniform float endValue;\n        \n        varying vec2 uv;\n        \n        void main() {\n          // get r and draw it\n          float width = "+y(g)+";\n          float start = startTime * width;\n          float end = endTime * width;\n          vec4 result = vec4(0);\n          for (float pointer = 0.0;pointer<="+y(g)+";pointer++){\n            if (pointer >= start && pointer <= end){\n              vec4 angle = texture2D(buffer, vec2((pointer + 0.5) / width, uv.y));\n              "+[0,1,2,3].map((function(e){return"\n              if (angle["+e+"] >= startValue && angle["+e+"] <= endValue) {\n                result["+e+"] = 1.0;\n              }\n              "})).join("")+"\n            }\n          }\n          gl_FragColor = result;\n        }",uniforms:{buffer:D.prop("buffer"),startTime:D.prop("startTime"),endTime:D.prop("endTime"),startValue:D.prop("startValue"),endValue:D.prop("endValue")},framebuffer:D.prop("out")})),K=D(S(S({},X),{frag:"\n        precision mediump float;\n      \n        uniform sampler2D buffer;\n        \n        varying vec2 uv;\n        \n        void main() {\n          float width = "+y(g)+";\n          float height = "+y(x)+";\n          vec4 result = vec4(0);\n          for (float x = 0.0;x<="+y(g)+";x++){\n            for (float y = 0.0;y<="+y(x)+";y++){\n              result = max(result, texture2D(buffer, vec2(x / width, y / height)));\n            }\n          }\n          gl_FragColor = result;\n        }",uniforms:{buffer:D.prop("buffer")},framebuffer:D.prop("out")})),U=D(S(S({},X),{frag:"\n    precision mediump float;\n      \n    uniform sampler2D buffer;\n    uniform sampler2D heat;\n    \n    varying vec2 uv;\n    \n    void main() {\n      float width = "+y(g)+";\n      float height = "+y(x)+";\n      vec4 sum = vec4(0);\n      for (float i = 0.0; i< "+y(g)+";i++){\n        vec4 pointer = texture2D(buffer, vec2(i / width, uv.y));\n        "+[0,1,2,3].map((function(e){return"\n        sum["+e+"] += texture2D(heat, vec2(i / width, pointer["+e+"])).x;\n        "})).join("")+"\n      }\n      gl_FragColor = sum;\n    }\n    ",uniforms:{buffer:D.prop("buffer"),heat:D.prop("heat")},framebuffer:D.prop("out")})),console.time("Allocate buffers"),J=D.framebuffer({width:Y,height:I,colorFormat:"rgba",colorType:"uint8"}),Q=D.framebuffer({width:Y,height:I,colorFormat:"rgba",colorType:"float"}),Z=D.framebuffer({width:g,height:Math.ceil(e.length/4),colorFormat:"rgba",colorType:"float"}),ee=D.framebuffer({width:1,height:Math.ceil(e.length/4),colorFormat:"rgba",colorType:"float"}),te=D.framebuffer({width:Y,height:R,colorFormat:"rgba",colorType:"float"}),ne=D.framebuffer({width:Y,height:I,colorFormat:"rgba",colorType:"float"}),re=D.framebuffer({width:g,height:I,colorFormat:"rgba",colorType:"float"}),oe=D.framebuffer({width:g,height:x,colorFormat:"rgba",colorType:"float"}),ae=D.framebuffer({width:1,height:1,colorFormat:"rgba",colorType:"float"}),console.timeEnd("Allocate buffers"),console.time("Compute heatmap"),ie=4*j*R,se=0,le=0,D.clear({color:[0,0,0,0],framebuffer:Z}),ce=0;ce<p;ce+=ie){console.time("Prepare Batch"),ue=new Array(Math.min(ie,p-se)),D.clear({color:[0,0,0,0],framebuffer:J});e:for(fe=0;fe<R;fe++)for(he=0;he<4*j;he++){if(se>=p)break e;de=e[se].xValues.length,ue[se-le]={values:b()(e[se].yValues),times:b()(e[se].xValues),maxY:r.stop,maxX:v,lineIdx:se,column:Math.floor(he/4),row:fe,colorMask:f(he),count:de,out:J,flatOut:Z},se++}console.timeEnd("Prepare Batch"),console.info("Drawing "+ue.length+" lines."),console.time("regl: drawFlatLine"),V(ue),console.timeEnd("regl: drawFlatLine"),console.time("regl: drawLine"),H(ue),console.timeEnd("regl: drawLine"),console.time("regl: gaussian"),P({buffer:J,out:Q}),console.timeEnd("regl: gaussian"),le+=ue.length,console.time("regl: sum"),$({buffer:Q,out:te}),console.timeEnd("regl: sum"),console.time("regl: normalize"),N({buffer:Q,sums:te,out:ne}),console.timeEnd("regl: normalize")}return console.time("regl: merge"),z({buffer:ne,out:re}),B({buffer:re,out:oe}),console.timeEnd("regl: merge"),console.timeEnd("Compute heatmap"),console.time("regl: findMax"),K({buffer:oe,out:ae}),me=Math.ceil(D.read({framebuffer:ae})[0]),console.timeEnd("regl: findMax"),console.log("max density is:",me),W({buffer:oe,maxi:me}),pe=w(e.length),[2,{filterAngle:function(e,t,n,r){var o,a;console.time("compute angle range"),o=O(M([e,t],0,1),2),e=o[0],t=o[1],a=O(M([n,r],-90,90),2),n=a[0],r=a[1],G({buffer:Z,out:ee,startTime:e,endTime:t,startAngle:n,endAngle:r});var i=D.read({framebuffer:ee});return console.timeEnd("compute angle range"),new Float32Array(i).map((function(e,t){return e?t+1:0})).filter((function(e){return e})).map((function(e){return e-1}))},filterRange:function(e,t,n,r){var o;console.time("compute rect range"),o=O(M([e,t,n,r],0,1),4),e=o[0],t=o[1],n=o[2],r=o[3],q({buffer:Z,out:ee,startTime:e,endTime:t,startValue:n,endValue:r});var a=D.read({framebuffer:ee});return console.timeEnd("compute rect range"),new Float32Array(a).map((function(e,t){return e?t+1:0})).filter((function(e){return e})).map((function(e){return e-1}))},findKTop:function(t,n){console.time("find-top"),console.time("regl: calWeight"),U({buffer:Z,heat:oe,out:ee});var o=F(D.read({framebuffer:ee})).map((function(t,n){return e[n]?{w:t,i:n}:{w:0,i:n}})).filter((function(e){return pe.includes(e.i)})).sort((function(e,n){return t?n.w-e.w:e.w-n.w}));if(console.timeEnd("regl: calWeight"),t&&n){for(var a=[],i=0;a.length<3&&i<o.length;i++){for(var s=!0,l=function(t){var l=e[o[i].i],c=e[a[t]],u=Math.min(l.xValues.length,c.xValues.length),f=l.yValues.slice(l.yValues.length-u).map((function(e,t){return(e-c.yValues[c.yValues.length-u+t])/r.stop}));if(E(f)<n)return s=!1,"break"},c=0;c<a.length;c++){var u=l(c);if("break"===u)break}s&&a.push(o[i].i)}return console.timeEnd("find-top"),a}return console.timeEnd("find-top"),o.slice(0,3).map((function(e){return e.i}))},rerender:function(t){t||(t=w(e.length)),pe=t,console.time("Compute heatmap");var n=4*j*R,o=0,a=0;D.clear({color:[0,0,0,0],framebuffer:ne});for(var i=0;i<t.length;i+=n){console.time("Prepare Batch");var s=new Array(Math.min(n,t.length-o));D.clear({color:[0,0,0,0],framebuffer:J});e:for(var l=0;l<R;l++)for(var c=0;c<4*j;c++){if(o>=t.length)break e;var u=e[t[o]].xValues.length;s[o-a]={values:b()(e[t[o]].yValues),times:b()(e[t[o]].xValues),maxY:r.stop,maxX:v,column:Math.floor(c/4),row:l,colorMask:f(c),count:u,out:J},o++}console.timeEnd("Prepare Batch"),console.info("Drawing "+s.length+" lines."),console.time("regl: drawLine"),H(s),console.timeEnd("regl: drawLine"),console.time("regl: gaussian"),P({buffer:J,out:Q}),console.timeEnd("regl: gaussian"),a+=s.length,console.time("regl: sum"),$({buffer:Q,out:te}),console.timeEnd("regl: sum"),console.time("regl: normalize"),N({buffer:Q,sums:te,out:ne}),console.timeEnd("regl: normalize")}console.time("regl: merge"),z({buffer:ne,out:re}),B({buffer:re,out:oe}),console.timeEnd("regl: merge"),console.timeEnd("Compute heatmap"),W({buffer:oe,maxi:me})},destroy:function(){D.destroy()},get maxDensity(){return me},set maxDensity(e){me==e||e<1||(me=e,W({buffer:oe,maxi:me}))},maxX:n.stop,maxY:r.stop}]}))}))};function E(e){var t=R(e),n=e.map((function(e){var n=e-t,r=n*n;return r})),r=R(n),o=Math.sqrt(r);return o}function R(e){var t=e.reduce((function(e,t){return e+t}),0),n=t/e.length;return n}n("5698");var Y={props:{timeIndex:Number,valueIndex:Number,timeName:String,valueName:String,filter:Float32Array},data:function(){return{canvas:null,contextHandler:null,canvasContext:null,rawLineContext:null,filterMode:"rect",rawMode:"null",diverse:.15,cursor:"crosshair",mouseDown:!1,listener:null,hoverListener:null,coord:[0,0,0,0,0],boxes:[],maxDensity:1,rawLines:[],colorMap:["aqua","limegreen","lightgreen"],upsideDown:!1,headers:[],previewIndex:-1}},computed:{rawLineNames:function(){return Object(i["a"])(this.rawLines).map((function(e){return _.aggregatedData[e].key}))},upsideDownFactor:function(){return this.upsideDown?-1:1},previewData:function(){var e=this;return this.previewIndex<0?[]:Object(i["a"])(_.aggregatedData[this.previewIndex].ref).slice(0,6).map((function(t,n){return 5==n?e.headers.map((function(e){return"..."})):_.data[t]}))}},watch:{filter:function(e){this.contextHandler.rerender(e),this.getTopK()},contextHandler:function(){this.filter&&this.contextHandler.rerender(this.filter)},filterMode:function(){this.resetFilter()},rawMode:function(){this.getTopK()},maxDensity:function(){this.contextHandler.maxDensity=this.maxDensity},diverse:function(){this.getTopK()},colorMap:function(){var e=this.rawLines;this.rawLineContext.clearRect(0,0,1e3,500);for(var t=this.colorMap,n=0;n<e.length;n++){var r=_.aggregatedData[e[n]];this.rawLineContext.globalAlpha=1,this.rawLineContext.strokeStyle=t[n%3],this.rawLineContext.lineWidth=2,this.rawLineContext.beginPath(),this.rawLineContext.moveTo(r[this.timeIndex][0]/this.contextHandler.maxX*1e3,500-r[this.valueIndex][0]/this.contextHandler.maxY*500);for(var o=0;o<r[this.timeIndex].length;o++)this.rawLineContext.lineTo(r[this.timeIndex][o]/this.contextHandler.maxX*1e3,500-r[this.valueIndex][o]/this.contextHandler.maxY*500);this.rawLineContext.stroke()}}},methods:{hoverLines:function(e){var t=this,n=e.offsetX,r=e.offsetY,o=this.contextHandler.filterRange((n-5)/1e3,(n+5)/1e3,1-(r+5)/500,1-(r-5)/500).filter((function(e){return!t.filter||t.filter.includes(e)})).slice(0,3);this.rawLineContext.clearRect(0,0,1e3,500);for(var a=this.colorMap,i=o.length-1;i>=0;i--){var s=_.aggregatedData[o[i]];this.rawLineContext.globalAlpha=1,this.rawLineContext.strokeStyle=a[i%3],this.rawLineContext.lineWidth=2,this.rawLineContext.beginPath(),this.rawLineContext.moveTo(s[this.timeIndex][0]/this.contextHandler.maxX*1e3,500-s[this.valueIndex][0]/this.contextHandler.maxY*500);for(var l=0;l<s[this.timeIndex].length;l++)this.rawLineContext.lineTo(s[this.timeIndex][l]/this.contextHandler.maxX*1e3,500-s[this.valueIndex][l]/this.contextHandler.maxY*500);this.rawLineContext.stroke()}this.rawLines=o},getTopK:function(){var e=[];switch(this.hoverListener&&this.$refs.canvas.removeEventListener("mousemove",this.hoverListener),this.rawMode){case"cur":this.hoverListener=this.hoverLines.bind(this),this.$refs.canvas.addEventListener("mousemove",this.hoverListener);break;case"out":e=this.contextHandler.findKTop(!1);break;case"rep":e=this.contextHandler.findKTop(!0,this.diverse);break}this.rawLineContext.clearRect(0,0,1e3,500);for(var t=this.colorMap,n=e.length-1;n>=0;n--){var r=_.aggregatedData[e[n]];this.rawLineContext.globalAlpha=1,this.rawLineContext.strokeStyle=t[n%3],this.rawLineContext.lineWidth=2,this.rawLineContext.beginPath(),this.rawLineContext.moveTo(r[this.timeIndex][0]/this.contextHandler.maxX*1e3,500-r[this.valueIndex][0]/this.contextHandler.maxY*500);for(var o=0;o<r[this.timeIndex].length;o++)this.rawLineContext.lineTo(r[this.timeIndex][o]/this.contextHandler.maxX*1e3,500-r[this.valueIndex][o]/this.contextHandler.maxY*500);this.rawLineContext.stroke()}this.rawLines=e},resetFilter:function(){this.$emit("filterChange",void 0),this.boxes=[],this.mouseDown=!1,this.canvasContext.clearRect(0,0,1e3,500),this.coord=[0,0,0,0,0]},startMouse:function(e){var t=this;if(!this.mouseDown){this.mouseDown=!0;var n=e.offsetX,r=e.offsetY,o=!1;if("rect"==this.filterMode){n/=1e3,r=1-r/500;var a,s=Object(l["a"])(this.boxes);try{for(s.s();!(a=s.n()).done;){var c=a.value;if((Math.abs(n-c[0])<=.002||Math.abs(n-c[1])<=.002)&&r>c[2]&&r<c[3]?(Math.abs(n-c[0])<=.002?this.mouseDown="left":this.mouseDown="right",o=!0):(Math.abs(r-c[2])<=.004||Math.abs(r-c[3])<=.004)&&n>c[0]&&n<c[1]?(Math.abs(r-c[2])<=.004?this.mouseDown="bottom":this.mouseDown="top",o=!0):n>c[0]&&n<c[1]&&r>c[2]&&r<c[3]&&(this.mouseDown="move",o=!0),o){var u=function(){t.coord=[1e3*c[0],500-500*c[3],1e3*c[1],500-500*c[2],0],t.boxes.splice(t.boxes.indexOf(c),1);var e=void 0;return t.boxes.forEach((function(n){var r,o=(r=t.contextHandler).filterRange.apply(r,Object(i["a"])(n));e=e?e.filter((function(e){return o.includes(e)})):o})),t.$emit("filterChange",e),"break"}();if("break"===u)break}}}catch(f){s.e(f)}finally{s.f()}}else Math.abs(n-this.coord[0])<=2&&Math.abs(r-this.coord[1])<=2?(this.mouseDown="move",o=!0):Math.abs(n-this.coord[2])<=2&&Math.abs(r-this.coord[3])<=Math.abs(this.coord[4]-this.coord[3])?(this.mouseDown="time",o=!0):n>this.coord[0]&&n<this.coord[2]&&r>this.coord[1]*(this.coord[2]-n)/(this.coord[2]-this.coord[0])+(this.coord[3]-Math.abs(this.coord[4]-this.coord[3]))*(n-this.coord[0])/(this.coord[2]-this.coord[0])&&r<this.coord[1]*(this.coord[2]-n)/(this.coord[2]-this.coord[0])+(this.coord[3]+Math.abs(this.coord[4]-this.coord[3]))*(n-this.coord[0])/(this.coord[2]-this.coord[0])&&(this.mouseDown="angular",o=!0);o||(this.coord=[0,0,0,0,0],this.coord[0]=e.offsetX,this.coord[1]=e.offsetY),this.listener=this.startFilter.bind(this),window.addEventListener("mouseup",this.listener)}},drawBoxes:function(){var e,t=Object(l["a"])(this.boxes);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.canvasContext.fillRect(1e3*n[0],500-500*n[3],1e3*(n[1]-n[0]),500*(n[3]-n[2]))}}catch(r){t.e(r)}finally{t.f()}},cursorShape:function(e){var t=e.offsetX,n=e.offsetY;switch(this.mouseDown){case"move":return void(this.cursor="grabbing");case"left":case"right":case"time":return void(this.cursor="ew-resize");case"top":case"bottom":case"angular":case"range":return void(this.cursor="ns-resize");case"magnet":case!0:return void(this.cursor="crosshair");default:if("rect"==this.filterMode){t/=1e3,n=1-n/500;var r,o=Object(l["a"])(this.boxes);try{for(o.s();!(r=o.n()).done;){var a=r.value;if((Math.abs(t-a[0])<=.002||Math.abs(t-a[1])<=.002)&&n>a[2]&&n<a[3])return void(this.cursor="ew-resize");if((Math.abs(n-a[2])<=.004||Math.abs(n-a[3])<=.004)&&t>a[0]&&t<a[1])return void(this.cursor="ns-resize");if(t>a[0]&&t<a[1]&&n>a[2]&&n<a[3])return void(this.cursor="move")}}catch(i){o.e(i)}finally{o.f()}}else{if(Math.abs(t-this.coord[0])<=2&&Math.abs(n-this.coord[1])<=2)return void(this.cursor="move");if(Math.abs(t-this.coord[2])<=2&&Math.abs(n-this.coord[3])<=Math.abs(this.coord[4]-this.coord[3]))return void(this.cursor="ew-resize");if(t>this.coord[0]&&t<this.coord[2]&&n>this.coord[1]*(this.coord[2]-t)/(this.coord[2]-this.coord[0])+(this.coord[3]-Math.abs(this.coord[4]-this.coord[3]))*(t-this.coord[0])/(this.coord[2]-this.coord[0])&&n<this.coord[1]*(this.coord[2]-t)/(this.coord[2]-this.coord[0])+(this.coord[3]+Math.abs(this.coord[4]-this.coord[3]))*(t-this.coord[0])/(this.coord[2]-this.coord[0]))return void(this.cursor="ns-resize")}this.cursor="crosshair"}},moveMouse:function(e){if(this.cursorShape(e),this.mouseDown)if("magnet"==this.mouseDown?this.coord[4]=e.offsetY:"move"==this.mouseDown?(this.coord[0]+=e.movementX,this.coord[2]+=e.movementX,this.coord[1]+=e.movementY*this.upsideDownFactor,this.coord[3]+=e.movementY*this.upsideDownFactor,this.coord[4]+=e.movementY*this.upsideDownFactor):"left"==this.mouseDown?this.coord[0]=e.offsetX:"right"==this.mouseDown?this.coord[2]=e.offsetX:"bottom"==this.mouseDown?this.coord[3]=e.offsetY:"top"==this.mouseDown?this.coord[1]=e.offsetY:"time"==this.mouseDown?this.coord[2]=Math.max(this.coord[0]+1,e.offsetX):"angular"==this.mouseDown?(this.coord[3]+=e.movementY*this.upsideDownFactor,this.coord[4]+=e.movementY*this.upsideDownFactor):(this.coord[2]=e.offsetX,this.coord[3]=e.offsetY),this.canvasContext.clearRect(0,0,1e3,500),"rect"==this.filterMode)this.canvasContext.globalAlpha=.3,this.canvasContext.fillStyle="black",this.drawBoxes(),this.canvasContext.fillRect(Math.min(this.coord[0],this.coord[2]),Math.min(this.coord[1],this.coord[3]),Math.abs(this.coord[2]-this.coord[0]),Math.abs(this.coord[3]-this.coord[1]));else if(this.canvasContext.globalAlpha=1,this.canvasContext.strokeStyle="black",this.canvasContext.beginPath(),this.canvasContext.moveTo(this.coord[0],this.coord[1]),this.canvasContext.lineTo(this.coord[2],this.coord[3]),this.canvasContext.stroke(),this.mouseDown&&!0!==this.mouseDown){var t=this.coord[4]-this.coord[3];this.canvasContext.beginPath(),this.canvasContext.moveTo(this.coord[2],this.coord[3]-t),this.canvasContext.lineTo(this.coord[2],this.coord[3]+t),this.canvasContext.stroke(),this.canvasContext.globalAlpha=.3,this.canvasContext.fillStyle="black",this.canvasContext.beginPath(),this.canvasContext.moveTo(this.coord[0],this.coord[1]),this.canvasContext.lineTo(this.coord[2],this.coord[3]-t),this.canvasContext.lineTo(this.coord[2],this.coord[3]+t),this.canvasContext.fill()}},startFilter:function(){if("rect"==this.filterMode&&(this.mouseDown=!1,0!=this.coord[2]||0!=this.coord[3])){var e=[this.coord[0],this.coord[2]].map((function(e){return e/1e3})).sort(),t=Object(s["a"])(e,2),n=t[0],r=t[1],o=[this.coord[1],this.coord[3]].map((function(e){return 1-e/500})).sort(),a=Object(s["a"])(o,2),i=a[0],l=a[1];this.boxes.push([n,r,i,l]);var c=this.contextHandler.filterRange(n,r,i,l);this.filter?this.$emit("filterChange",this.filter.filter((function(e){return c.includes(e)}))):this.$emit("filterChange",c)}window.removeEventListener("mouseup",this.listener),this.listener=null},angleConfirm:function(){if("ang"==this.filterMode&&this.coord[2]&&this.coord[3]&&this.coord[0]!=this.coord[2])if(!0===this.mouseDown){this.mouseDown="magnet";var e=[0,0],t=[0,0];this.coord[0]<this.coord[2]?(e=this.coord.slice(0,2),t=this.coord.slice(2,4)):(t=this.coord.slice(0,2),e=this.coord.slice(2,4)),this.coord=[].concat(Object(i["a"])(e),Object(i["a"])(t),[0])}else if(this.mouseDown){this.mouseDown=!1;var n=Math.abs(this.coord[4]-this.coord[3]),r=-(this.coord[3]+n-this.coord[1])/(this.coord[2]-this.coord[0]),o=-(this.coord[3]-n-this.coord[1])/(this.coord[2]-this.coord[0]);this.$emit("filterChange",this.contextHandler.filterAngle(this.coord[0]/1e3,this.coord[2]/1e3,r,o))}},exportFig:function(){C([this.$refs.canvas,this.$refs.canvasOverlay,this.$refs.canvasRawLine],this.upsideDown)}},mounted:function(){var e=this;this.headers=_.headers.map((function(e,t){return{title:e,key:t,minWidth:150}})),this.$Spin.show(),setTimeout((function(){e.canvas=e.$refs.canvas,e.canvasContext=e.$refs.canvasOverlay.getContext("2d"),e.rawLineContext=e.$refs.canvasRawLine.getContext("2d");for(var t=_.aggregatedData.map((function(t){return{xValues:t[e.timeIndex],yValues:t[e.valueIndex]}})),n=t[0].yValues[0],r=n,o=t[0].xValues[0],a=o,i=0;i<t.length;i++)for(var s=t[i].xValues.length,l=0;l<s;l++){var c=t[i].yValues[l],u=t[i].xValues[l];n=Math.max(n,c),r=Math.min(r,c),o=Math.max(o,u),a=Math.min(a,u)}for(var f=0;f<t.length;f++)for(var h=t[f].xValues.length,d=0;d<h;d++)t[f].xValues[d]-=a;var m=Object(D["a"])({maxbins:p,extent:[0,o-a]}),g=Object(D["a"])({maxbins:v,extent:[0,n]});j(t,[0,o-a,r,n],m,g,e.canvas).then((function(t){e.contextHandler=t,e.maxDensity=t.maxDensity})),e.$Spin.hide()}),0)},beforeDestroy:function(){this.contextHandler&&this.contextHandler.destroy()}},I=Y,H=(n("0c4e"),n("2877")),V=Object(H["a"])(I,f,h,!1,null,null,null),X=V.exports,P=n("86ec"),$=n.n(P),N=n("bc3a"),z=n.n(N),B=function(e,t,n,r){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,a){function i(e){try{l(r.next(e))}catch(t){a(t)}}function s(e){try{l(r["throw"](e))}catch(t){a(t)}}function l(e){e.done?n(e.value):o(e.value).then(i,s)}l((r=r.apply(e,t||[])).next())}))},W=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(e){return function(t){return l([e,t])}}function l(a){if(n)throw new TypeError("Generator is already executing.");while(i)try{if(n=1,r&&(o=2&a[0]?r["return"]:a[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(o=i.trys,!(o=o.length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(s){a=[6,s],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},G=[n("9833").default,n("8802").default,n("51f2").default,n("5a12").default];function q(e){return B(this,void 0,void 0,(function(){var t,n;return W(this,(function(r){switch(r.label){case 0:return[4,z.a.get(G[e-1])];case 1:return t=r.sent(),n=$()(t.data,{skip_empty_lines:!0}),[2,n]}}))}))}function K(e){return B(this,void 0,void 0,(function(){return W(this,(function(t){return[2,new Promise((function(t){var n=new FileReader;n.onload=function(){t($()(n.result,{skip_empty_lines:!0}))},n.readAsText(e)}))]}))}))}function U(e,t){switch(t){case"string":return 0;case"date":return Math.floor(new Date(e)/864e5);case"number":return parseFloat(e)}}var J={name:"App",components:{CanvasBox:X},data:function(){return{headers:[],inferTypes:[],aggregateAttr:0,timeAttr:0,valueAttr:[],chartConfigs:[],filters:[]}},methods:{eventHandler:function(e){var t=this;this.$Spin.show(),e.startsWith("1")?q(e.split("-")[1]).then((function(e){t.$Spin.hide(),t.preProcessData(e),t.generateCharts()})):"2"==e&&(this.$refs.upload.handleClick(),this.$Spin.hide())},readFileHandler:function(e){var t=this;return this.$Spin.show(),K(e).then((function(e){t.$Spin.hide(),t.preProcessData(e),t.generateCharts()})),!1},preProcessData:function(e){if(this.headers=e[0],_.headers=e[0],_.data=e.slice(1),e.length>1){this.inferTypes=e[1].map((function(e){if(e.includes("-")||e.includes("/")){var t=new Date(e).toString();return t.startsWith("Invalid")?"string":"date"}return/^\d*(\.\d*)?$/.test(e)?"number":"string"})),this.aggregateAttr=this.inferTypes.indexOf("string"),this.timeAttr=this.inferTypes.indexOf("date");var t=this.inferTypes.indexOf("number");this.aggregateAttr<0&&(this.aggregateAttr=0),this.timeAttr<0&&(this.timeAttr=this.inferTypes.indexOf("number")),this.timeAttr<0&&(this.timeAttr=0),t>=0&&(this.valueAttr=[t])}},generateCharts:function(){var e=this;if(!(this.valueAttr.length>3)||confirm("This may causing out of GPU memory, are you sure to continue?")){if(this.$Spin.show(),this.headers[this.aggregateAttr]!=(this.chartConfigs.length&&this.chartConfigs[0].aggregateName)||this.valueAttr.find((function(t){return!e.chartConfigs.find((function(e){return e.valueIndex===t}))}))){_.aggregatedData=[];var t=new Map,n=Object(u["a"])(Object(c["a"])({},this.timeAttr,this.inferTypes[this.timeAttr]),this.valueAttr.map((function(t){return Object(c["a"])({},t,e.inferTypes[t])})).reduce((function(e,t){return Object(u["a"])({},e,{},t)}),{}));_.data.forEach((function(r,o){var a,i=r[e.aggregateAttr];t.has(i)?a=t.get(i):(a=Object(u["a"])(Object(c["a"])({ref:[]},e.timeAttr,[]),e.valueAttr.map((function(e){return Object(c["a"])({},e,[])})).reduce((function(e,t){return Object(u["a"])({},e,{},t)}),{})),t.set(i,a)),a.ref.push(o),a[e.timeAttr].push(U(r[e.timeAttr],n[e.timeAttr])),e.valueAttr.forEach((function(e){a[e].push(U(r[e],n[e]))}))}));var r,o=Object(l["a"])(t.entries());try{for(o.s();!(r=o.n()).done;){var a=Object(s["a"])(r.value,2),i=a[0],f=a[1];_.aggregatedData.push(Object.entries(f).reduce((function(e,t){return Object(u["a"])({},e,Object(c["a"])({},t[0],new Float32Array(t[1])))}),{key:i}))}}catch(h){o.e(h)}finally{o.f()}t.clear()}this.chartConfigs=this.valueAttr.map((function(t){return t==e.timeAttr?null:{aggregateIndex:e.aggregateAttr,timeIndex:e.timeAttr,valueIndex:t,aggregateName:e.headers[e.aggregateAttr],timeName:e.headers[e.timeAttr],valueName:e.headers[t],filter:void 0,emitFilter:void 0}})).filter((function(e){return e})),this.filters=this.chartConfigs.map((function(e){})),this.$Spin.hide()}},handleFilterChange:function(e,t){var n=this;if(this.filters.splice(e,1,t),this.filters.find((function(e){return e}))){var r=new Float32Array(new Set(this.filters.reduce((function(e,t){return[].concat(Object(i["a"])(e),Object(i["a"])(t||[]))}),[]).filter((function(e){return!n.filters.find((function(t){return!(t&&t.includes(e))}))}))));this.chartConfigs.forEach((function(e){n.$set(e,"filter",r)}))}else this.chartConfigs.forEach((function(e){n.$set(e,"filter",void 0)}))}}},Q=J,Z=(n("5c0b"),Object(H["a"])(Q,o,a,!1,null,null,null)),ee=Z.exports,te=n("f825"),ne=n.n(te);n("f8ce");r["default"].use(ne.a),r["default"].config.productionTip=!1,new r["default"]({render:function(e){return e(ee)}}).$mount("#app");var re=document.createElement("canvas"),oe=re.getContext("webgl"),ae=oe.getExtension("WEBGL_debug_renderer_info"),ie=oe.getParameter(ae.UNMASKED_RENDERER_WEBGL).toLowerCase();ie.includes("intel")&&alert("Your GPU memory may not big enough to run the program properly, but you can have a try.")},"5a12":function(e,t,n){"use strict";n.r(t),t["default"]=n.p+"3e25f7c9975fbd472e611cf20d851df7.csv"},"5c0b":function(e,t,n){"use strict";var r=n("9c0c"),o=n.n(r);o.a},8802:function(e,t,n){"use strict";n.r(t),t["default"]=n.p+"a6681c9f5f12e0afbe1892e95414e715.csv"},9833:function(e,t,n){"use strict";n.r(t),t["default"]=n.p+"b9c8219653d8ec39d5473283116881ee.csv"},"9c0c":function(e,t,n){}});
//# sourceMappingURL=app.e0914325.js.map